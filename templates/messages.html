{% extends "base.html" %}

{% block content %}
{% load static %}
<link href="{% static "assets/css/chat.css" %}" rel="stylesheet" type="text/css" />
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">


    <!-- Page header start -->
    <div class="page-title">
        <div class="row gutters float-right">
            <div class="col-lg-12 col-lg-6 col-md-6 col-sm-12 col-12">
                {% if user.is_authenticated %}
                <h5 class="title">Logged In as : {{user}}</h5>
                <input type="hidden" id="logged-in-user" value="{{ user.id }}">
                {% endif %}
            </div>
            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12"> </div>
        </div>
    </div>
    <!-- Page header end -->



            <div class="col-xl-12 col-lg-12 bg-gray">

                <div class="card m-0">

                    <!-- Row start -->
                    <div class="row no-gutters">
                        <div class="col-xl-4 col-lg-4 col-md-4 col-sm-3 col-3">

                            {% comment %} CONTACT_BODY {% endcomment %}
                            <div class="users-container contacts_body">
                                    <div class="text-center">
                                        <h1 class="text-center fw-bold text-primary">
                                            <i class="fas fa-envelope"></i>&nbsp;Inbox
                                        </h1>
                                    </div>
                                <ul class="users">
                                    {% for thread in Threads %}
                                    <li class="{% if forloop.first %}active{% endif %} contact-li person" chat-id="chat_{{ thread.id }}" data-chat="person5" style="cursor: pointer; background-color:#e5e5e5;">
                                        <div class="user">
                                            <img src="https://www.bootdey.com/img/Content/avatar/avatar5.png" alt="Retail Admin">
                                            <span class="status away"></span>
                                        </div>
                                        <p class="name-time">
                                            {% if thread.first_person == user %}
                                                <span>{{ thread.second_person.full_name }}</span>
                                            {% else %}
                                                <span>{{ thread.first_person.full_name }}</span>
                                            {% endif %}
                                        </p>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                        <div class="col-xl-8 col-lg-8 col-md-8 col-sm-9 col-9">
                        
                            <div class="chat-container">
                                {% for thread in Threads %}
                                    <div class="messages-wrapper {% if forloop.first %}is_active{% else %}hide{% endif %}" chat-id="chat_{{ thread.id }}" other-user-id="
                                        {% if thread.first_person == user %}
                                            {{ thread.second_person.id }}
                                        {% else %}
                                            {{ thread.first_person.id }}
                                        {% endif %}
                                    ">
                                        <div class="selected-user">
                                            <span>To: <span class="name">
                                                {% if thread.first_person == user %}
                                                    {{ thread.second_person.full_name }}
                                                {% else %}
                                                    {{ thread.first_person.full_name }}
                                                {% endif %}
                                            </span></span>
                                        </div>
                                        <div class="card-body msg_card_body">
                                            <!-- Messages will be appended here -->
                                        </div>
                                        <div class="card-footer">
                                            <form id="send-message-form">
                                                <div class="input-group">
                                                    <div class="input-group-append">
                                                        <span class="input-group-text attach_btn"><i class="fas fa-paperclip"></i></span>
                                                    </div>
                                                    <input type="text" name="" id="input-message" class="form-control type_msg p-4" placeholder="Type your message...">
                                                    <div class="input-group-append">
                                                        <button class="btn btn-secondary" type="submit">
                                                            <span class="input-group-text send_btn">
                                                                <i class="fas fa-location-arrow"></i>
                                                            </span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <!-- Row end -->
                </div>

            </div>

<script src="{% static 'assets/js/messages.js' %}"></script>
{% endblock content %}