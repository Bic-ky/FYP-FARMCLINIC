{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="row">
    <div class="col-12">
        <div class="card m-b-30">
            <div class="card-body">

                <div class="row">
                    <div class="col-lg-3 col-md-4">
                        {% for apt in appointments  %}

                        <div id='external-events' class="mt-4">
                            <div class='fc-event'><h6>{{apt}}</h6></div>
                        </div>
                        {% endfor %}

                    </div>

                    <div id='calendar' class="col-lg-9 col-md-8 mt-3 mt-lg-0"></div>

                </div>
                <!-- end row -->

            </div>
        </div>
    </div> <!-- end col -->
</div> <!-- end row --> 

<!-- Overlay-->
<div class="menu-overlay"></div>



<!--calendar js-->
<script src="{% static "plugins/jquery-ui/jquery-ui.min.js" %}"></script>
<script src="{% static "plugins/moment/moment.js" %}"></script>
<script src="{% static "plugins/fullcalendar/js/fullcalendar.min.js" %}"></script>
<script src="{% static "assets/js/calendar-demo.js" %}"></script>
<script>
    !function($) {
        "use strict";

        var CalendarPage = function() {};

        CalendarPage.prototype.init = function() {

            //checking if plugin is available
            if ($.isFunction($.fn.fullCalendar)) {
                /* initialize the calendar */
                $('#calendar').fullCalendar({
                    header: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'month,basicWeek,basicDay'
                    },
                    events: function(start, end, timezone, callback) {
                        $.ajax({
                            url: "{% url 'appointment_list' %}",
                            dataType: 'json',
                            success: function(data) {
                                var events = [];
                                $(data).each(function() {
                                    events.push({
                                        title: this.title,
                                        start: this.start,
                                        end: this.end,
                                        allDay: this.allDay
                                    });
                                });
                                callback(events);
                            },
                            error: function() {
                                alert('There was an error while fetching events.');
                            }
                        });
                    }
                });

            } else {
                alert("Calendar plugin is not installed");
            }
        },
        //init
        $.CalendarPage = new CalendarPage, $.CalendarPage.Constructor = CalendarPage
    }(window.jQuery),

    //initializing 
    function($) {
        "use strict";
        $.CalendarPage.init()
    }(window.jQuery);
</script>


{% endblock content %}